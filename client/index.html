<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Vladogram</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&family=Space+Grotesk:wght@500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div id="app-shell" class="app-shell">
      <aside class="sidebar">
        <div class="sidebar-header">
          <button id="menu-btn" class="icon-btn" type="button" aria-label="Открыть меню">
            <span class="burger" aria-hidden="true"></span>
          </button>
          <div class="brand">
            <span class="brand-mark">VG</span>
            <span class="brand-name">Vladogram</span>
          </div>
          <div id="socket-status" class="socket-pill">Офлайн</div>
        </div>

        <div class="sidebar-search">
          <input id="chat-search" type="text" placeholder="Поиск по чатам" />
        </div>

        <div id="chat-list" class="chat-list"></div>

        <form id="chat-create-form" class="chat-create">
          <input id="new-chat-peer" type="text" placeholder="Ник собеседника" />
          <button type="submit">Открыть чат</button>
        </form>
      </aside>

      <main class="main">
        <header class="chat-header">
          <div class="chat-peer">
            <div id="chat-title" class="chat-peer-name">Чат не выбран</div>
            <div class="chat-peer-meta">
              <span id="chat-peer" class="muted">Был(а) в сети: -</span>
              <span id="chat-connection" class="status">Отключен</span>
              <button id="alias-btn" type="button" class="link-btn small">Переименовать</button>
            </div>
          </div>
          <div class="chat-actions">
            <button class="icon-action" type="button" aria-label="Поиск">
              <svg class="icon-svg" viewBox="0 0 24 24" aria-hidden="true">
                <circle cx="11" cy="11" r="7"></circle>
                <path d="M20 20l-3.5-3.5"></path>
              </svg>
            </button>
            <button class="icon-action" type="button" aria-label="Звонок">
              <svg class="icon-svg" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M7 3l3 1-1.5 3a15 15 0 0 0 6.5 6.5L18 12l3 3c-2.5 3-6 5-9 6-4-2-7-5-9-9 1-3 3-6 4-9z"></path>
              </svg>
            </button>
            <button class="icon-action" type="button" aria-label="Меню">
              <svg class="icon-svg" viewBox="0 0 24 24" aria-hidden="true">
                <circle cx="5" cy="12" r="1.8"></circle>
                <circle cx="12" cy="12" r="1.8"></circle>
                <circle cx="19" cy="12" r="1.8"></circle>
              </svg>
            </button>
            <button id="chat-back" type="button" class="ghost-btn">Назад</button>
          </div>
        </header>

        <div id="chat-empty" class="chat-empty is-visible">
          <div class="chat-empty-card">
            <h2>Выберите чат</h2>
            <p>Найдите или откройте чат слева, чтобы начать переписку.</p>
          </div>
        </div>

        <div id="messages" class="messages"></div>
        <div id="typing-status" class="typing status"></div>

        <form id="message-form" class="composer">
          <div class="attach-wrapper">
            <button id="attach-btn" type="button" class="icon-btn" aria-label="Прикрепить">
              <span class="icon">+</span>
            </button>
            <div id="attach-menu" class="attach-menu is-hidden">
              <button type="button" data-attach="image">Изображение</button>
              <button type="button" data-attach="document">Документ</button>
            </div>
            <input id="attach-image" type="file" accept="image/*" class="is-hidden" />
            <input id="attach-doc" type="file" class="is-hidden" />
          </div>
          <input
            id="message-input"
            type="text"
            placeholder="Введите сообщение..."
            autocomplete="off"
          />
          <button id="send-btn" type="submit" class="send-btn">Отправить</button>
        </form>
        <div id="attach-status" class="status attach-status"></div>
      </main>
    </div>

    <section id="auth-screen" class="auth-screen is-visible">
      <div class="auth-card">
        <div class="auth-title">
          <h1>Добро пожаловать в Vladogram</h1>
          <p>Войдите с одноразовым кодом или создайте новый аккаунт.</p>
        </div>
        <div id="crypto-warning" class="status"></div>
        <div class="auth-switch">
          <button id="auth-login-tab" type="button" class="tab-btn is-active">Войти</button>
          <button id="auth-register-tab" type="button" class="tab-btn">Регистрация</button>
        </div>

        <div id="auth-login-view" class="auth-view is-active">
          <div class="auth-grid">
            <form id="login-form" class="auth-panel">
              <h2>Войти</h2>
              <label>
                Ник
                <input id="login-nickname" type="text" placeholder="ник" autocomplete="username" />
              </label>
              <label>
                Одноразовый код
                <input
                  id="login-one-time"
                  type="text"
                  placeholder="код входа"
                  autocomplete="one-time-code"
                />
              </label>
              <button type="submit">Войти</button>
              <button id="auth-show-register" type="button" class="link-btn">
                Зарегистрироваться
              </button>
              <div id="login-status" class="status"></div>
              <pre id="login-output" class="mono"></pre>
            </form>

            <form id="refresh-form" class="auth-panel small">
              <h2>Обновить сессию</h2>
              <p class="muted">Используйте после повторного открытия вкладки.</p>
              <button type="submit">Обновить</button>
              <div id="refresh-status" class="status"></div>
              <pre id="refresh-output" class="mono"></pre>
            </form>
          </div>
        </div>

        <div id="auth-register-view" class="auth-view">
          <div class="auth-grid">
            <form id="register-form" class="auth-panel">
              <h2>Создать аккаунт</h2>
              <label>
                Ник
                <input id="register-nickname" type="text" placeholder="ник" autocomplete="username" />
              </label>
              <button type="submit">Создать</button>
              <button id="auth-show-login" type="button" class="link-btn">
                Уже есть аккаунт? Войти
              </button>
              <div id="register-qr-block" class="qr-block is-hidden">
                <div class="muted">Сканируйте QR в Google Authenticator.</div>
                <img id="register-qr-image" alt="QR код для входа" />
                <div class="muted">Секрет (для ручного ввода):</div>
                <div id="register-qr-secret" class="mono"></div>
              </div>
              <div id="register-status" class="status"></div>
            </form>
          </div>
        </div>
      </div>
    </section>

    <div id="menu-modal" class="modal">
      <div class="modal-backdrop" data-close="menu"></div>
      <div class="modal-panel">
        <button class="modal-close" type="button" data-close="menu" aria-label="Закрыть">x</button>
        <div class="profile-block">
          <div id="menu-avatar" class="avatar">?</div>
          <div id="menu-nickname" class="profile-name">Гость</div>
        </div>
        <button id="open-settings-btn" type="button" class="menu-btn">Настройки</button>
      </div>
    </div>

    <div id="settings-modal" class="modal">
      <div class="modal-backdrop" data-close="settings"></div>
      <div class="modal-panel settings-panel">
        <button class="modal-close" type="button" data-close="settings" aria-label="Закрыть">x</button>
        <h2>Настройки</h2>

        <div class="settings-section">
          <div class="settings-head">
            <div>
              <strong>Одноразовый код для входа</strong>
              <div class="muted">Создайте код и передайте его для входа на другом устройстве.</div>
            </div>
            <button id="login-code-btn" type="button">Создать код</button>
          </div>
          <div id="login-code-value" class="mono"></div>
          <div id="login-code-status" class="status"></div>
        </div>

        <div class="settings-section">
          <div class="settings-head">
            <div>
              <strong>Профиль</strong>
              <div class="muted">Дисплей имя и аватар.</div>
            </div>
            <button id="profile-save-btn" type="button">Сохранить</button>
          </div>
          <label>
            Дисплей имя
            <input id="profile-display-name" type="text" placeholder="как вас будут видеть" />
          </label>
          <div class="profile-row">
            <div id="profile-avatar-preview" class="avatar small">?</div>
            <div class="profile-actions">
              <button id="profile-avatar-btn" type="button" class="secondary">Загрузить аватар</button>
              <input id="profile-avatar-input" type="file" accept="image/*" class="is-hidden" />
            </div>
          </div>
          <div id="profile-status" class="status"></div>
        </div>

        <div class="settings-section">
          <div class="settings-head danger">
            <div>
              <strong>Сменить точку</strong>
              <div class="muted">Очистить чаты, сбросить epoch, отозвать устройства.</div>
            </div>
            <button id="change-point-btn" type="button" class="danger-btn">Сбросить</button>
          </div>
          <div class="settings-head">
            <div>
              <strong>Выйти</strong>
              <div class="muted">Отозвать refresh-сессию.</div>
            </div>
            <button id="logout-btn" type="button">Выйти</button>
          </div>
          <div id="settings-status" class="status"></div>
        </div>
      </div>
    </div>

    <script src="socket.io/socket.io.js"></script>
    <script src="app.js"></script>
  </body>
</html>
